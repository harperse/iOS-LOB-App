MS Graph Auth
Encryption in PSCore with .NET 5/6?

Access token -> Graph

Automation app - Bamboo / Bambu?
Attributes to PS1 for globals
Bamboo has a script task as part of CI/CD pipeline

Which app registration/SP should we be hitting?
Delegated permission rather than service principal

https://docs.microsoft.com/en-us/mem/intune/apps/lob-apps-ios

Introduce Azure Automation account to perform post-file-push tasks

Fully extensible to be able to push multiple packages

$global:sourceFile = "/Users/ae00443/Documents/LOB/AnthemPulseV30.ipa"
$global:displayName = "Anthem Pulse"
$global:publisher = "Anthem"
$global:description = "Anthem Pulse app provides easy access and on the go essential capabilities for members, employees and public users such as employers, care professionals, care providers, lab technicians. Features include COViD self-assessment, resources, latest news, employers access to COVID dashboards, job seekers to find careers at Anthem, and track application status on the go, and many more. Secure and conven..."
$global:bundleId = "com.anthem.pulse.dev"
$global:identityVersion = "30.0"
$global:versionNumber = "30"
$global:expirationDateTime = "2022-06-29T12:26:48Z"


1.  Automation account creation and preparation
    a. service principal
    b. module(s)
    c. runbook(s)
    d. webhook(s)
2.  Storage account creation and file upload
    a. payload and JSON
    b. storage account key
    c. webhook call
3.  Runbook execution against Graph
    a. open request body
    b. make call
    c. examine output



Original framework:
Get Graph token and convert to secureToken
Verify file
Verify expirationDateTime
Create tempFile
Create variable from sourceFile (redundant)
Form JSON body
Encrypt file
Create manifest XML
Make POST request for app
Make POST request for content version
Make POST request to add file
Wait for service to process the file request
Upload content to Azure
Commit the file
Wait for service to process the file commit
Complete app commitment

TODO:
Upload the file(s)
Call the webhook
